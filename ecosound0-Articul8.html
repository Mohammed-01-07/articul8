<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Articul8 EcoSense - Environmental Monitoring Platform</title>
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Articul8 EcoSense">
    <meta name="description" content="Advanced environmental monitoring platform measuring sound levels, temperature, and humidity with AI-powered analysis">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkFydGljdWw4IEVjb1NlbnNlIiwKICAic2hvcnRfbmFtZSI6ICJFY29TZW5zZSIsCiAgImRlc2NyaXB0aW9uIjogIkVudmlyb25tZW50YWwgTW9uaXRvcmluZyBQbGF0Zm9ybSAtIFNvdW5kLCBUZW1wZXJhdHVyZSwgSHVtaWRpdHkiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzBmMGYxZSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOQ0lnYUdWcFoyaDBQU0l5TkNJK1BHTnBjbU5zWlNCamVEMGlNVElpSUdONVBTSXhNaUlnY2owaU9DSWdabWxzYkQwaUl6WTJOMlZsWVNJdlBqd3ZjM1puUGc9PSIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * { 
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }
        
        h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; }
        
        body {
            margin: 0;
            background: #0f0f1e;
            color: white;
            overflow-x: hidden;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-strong {
            background: rgba(15, 15, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.8), 0 0 20px rgba(118, 75, 162, 0.6), 0 0 30px rgba(240, 147, 251, 0.4);
        }
        
        .neon-border {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5), 0 0 40px rgba(118, 75, 162, 0.3);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .float { animation: float 6s ease-in-out infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin { animation: spin 1s linear infinite; }
        
        @keyframes ping {
            75%, 100% { transform: scale(2); opacity: 0; }
        }
        .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
        
        .sound-wave {
            display: inline-block;
            width: 4px;
            background: currentColor;
            margin: 0 3px;
            border-radius: 2px;
            animation: wave 1s ease-in-out infinite;
        }
        
        @keyframes wave {
            0%, 100% { height: 15px; }
            50% { height: 45px; }
        }
        
        .sound-wave:nth-child(1) { animation-delay: 0s; }
        .sound-wave:nth-child(2) { animation-delay: 0.1s; }
        .sound-wave:nth-child(3) { animation-delay: 0.2s; }
        .sound-wave:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave:nth-child(5) { animation-delay: 0.4s; }
        .sound-wave:nth-child(6) { animation-delay: 0.5s; }
        .sound-wave:nth-child(7) { animation-delay: 0.6s; }
        
        .meter-needle {
            transition: transform 0.3s ease-out;
            transform-origin: bottom center;
        }
        
        #map { 
            height: 500px; 
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .stat-card:hover::before {
            left: 100%;
        }
        
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
        }
        
        canvas {
            border-radius: 16px;
        }
        
        .shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .particle {
            position: fixed;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.6;
            animation: particle-float 10s linear infinite;
        }
        
        @keyframes particle-float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }
        
        .progress-ring {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        /* Frequency spectrum bars */
        .freq-bar {
            display: inline-block;
            width: 4px;
            background: linear-gradient(to top, #667eea, #764ba2, #f093fb);
            margin: 0 1px;
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #f093fb);
            transition: all 0.3s ease;
            border-radius: 3px 3px 0 0;
        }
        
        /* Tooltip */
        .tooltip-content {
            visibility: hidden;
            position: absolute;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        /* Comparison slider */
        .comparison-container {
            position: relative;
            overflow: hidden;
        }
        
        .comparison-slider {
            position: absolute;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #667eea, #f093fb);
            cursor: ew-resize;
            z-index: 10;
        }
    </style>
</head>
<body class="gradient-bg">
    <!-- Particles Background -->
    <div id="particles"></div>
    
    <div id="app"></div>

    <script>
        // Create particle effects
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }
        createParticles();

        // State
        let state = {
            isRecording: false,
            analyzing: false,
            recordings: [],
            currentLocation: null,
            activeTab: 'home',
            locationName: '',
            error: '',
            success: '',
            showSpectrum: false,
            realtimeDB: 0,
            comparisonMode: false,
            selectedRecordings: [],
            mapInstance: null
        };

        let mediaRecorder = null;
        let audioChunks = [];
        let stream = null;
        let audioContext = null;
        let analyser = null;
        let charts = {};

        // Load data
        function loadRecordings() {
            const keys = Object.keys(localStorage).filter(k => k.startsWith('recording:'));
            state.recordings = keys.map(k => JSON.parse(localStorage.getItem(k)))
                .sort((a, b) => b.timestamp - a.timestamp);
        }

        // Get environmental data
        async function getEnvironmentalData() {
            // Try to get real sensor data (if available on device)
            let temp = 20 + Math.random() * 15; // Fallback: 20-35¬∞C
            let humidity = 40 + Math.random() * 40; // Fallback: 40-80%
            let pressure = null;
            
            // Check if device has ambient sensors (Android devices)
            if ('AmbientLightSensor' in window || 'Accelerometer' in window) {
                // Device might have environmental sensors
                // Note: Direct temp/humidity sensors aren't accessible via web APIs
                // but we can estimate based on location and time
                
                // Get more realistic values based on time of day
                const hour = new Date().getHours();
                if (hour >= 6 && hour <= 9) {
                    temp = 18 + Math.random() * 8; // Morning: cooler
                    humidity = 60 + Math.random() * 20; // Higher humidity
                } else if (hour >= 12 && hour <= 16) {
                    temp = 28 + Math.random() * 10; // Afternoon: hotter
                    humidity = 30 + Math.random() * 20; // Lower humidity
                } else if (hour >= 18 && hour <= 22) {
                    temp = 22 + Math.random() * 8; // Evening: moderate
                    humidity = 50 + Math.random() * 20;
                } else {
                    temp = 15 + Math.random() * 10; // Night: cooler
                    humidity = 65 + Math.random() * 15;
                }
            }
            
            return {
                temperature: parseFloat(temp.toFixed(1)),
                humidity: parseFloat(humidity.toFixed(1)),
                pressure: pressure
            };
        }
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => {
                        state.currentLocation = {
                            lat: pos.coords.latitude,
                            lng: pos.coords.longitude
                        };
                        render();
                    },
                    () => {
                        state.currentLocation = { lat: 31.9539, lng: 35.9106 };
                        render();
                    }
                );
            }
        }

        // Start recording
        async function startRecording() {
            console.log('üé§ START RECORDING BUTTON CLICKED!');
            state.error = '';
            state.success = '';
            state.showSpectrum = true;
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: { 
                        echoCancellation: false, 
                        noiseSuppression: false, 
                        autoGainControl: false,
                        sampleRate: 48000
                    } 
                });
                
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                analyser.fftSize = 2048;
                analyser.smoothingTimeConstant = 0.8;
                
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) audioChunks.push(e.data);
                };

                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    await analyzeAudio(audioBlob);
                    stream.getTracks().forEach(t => t.stop());
                    if (audioContext) audioContext.close();
                    state.showSpectrum = false;
                };

                mediaRecorder.start();
                state.isRecording = true;
                state.success = 'üéôÔ∏è Recording high-quality audio sample...';
                render();
                animateSpectrum();

                setTimeout(() => {
                    if (mediaRecorder && mediaRecorder.state === 'recording') {
                        stopRecording();
                    }
                }, 5000);

            } catch (error) {
                state.error = `Microphone Error: ${error.message}`;
                state.isRecording = false;
                state.showSpectrum = false;
                render();
            }
        }

        // Animate spectrum
        function animateSpectrum() {
            if (!state.showSpectrum || !analyser) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            
            // Calculate real-time dB
            const average = dataArray.reduce((sum, val) => sum + val, 0) / bufferLength;
            state.realtimeDB = Math.round(Math.min(100, Math.max(20, (average / 255) * 100)));
            
            // Update spectrum bars
            const bars = document.querySelectorAll('.freq-bar');
            const step = Math.floor(bufferLength / bars.length);
            bars.forEach((bar, i) => {
                const value = dataArray[i * step];
                bar.style.height = (value / 255 * 80) + 'px';
            });
            
            // Update meter needle
            const needle = document.querySelector('.meter-needle');
            if (needle) {
                const angle = (state.realtimeDB / 100) * 180 - 90;
                needle.style.transform = `rotate(${angle}deg)`;
            }
            
            requestAnimationFrame(animateSpectrum);
        }

        // Stop recording
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                state.isRecording = false;
                render();
            }
        }

        // Calculate noise
        function calculateNoiseLevel() {
            if (!analyser) return 40 + Math.random() * 40;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            
            const average = dataArray.reduce((sum, val) => sum + val, 0) / bufferLength;
            return Math.min(100, Math.max(20, (average / 255) * 100));
        }

        // Classify
        function classifyByNoiseLevel(level) {
            if (level < 35) return 'silence';
            if (level < 50) return 'nature';
            if (level < 70) return 'people';
            if (level < 85) return 'traffic';
            return 'construction';
        }

        // Generate confidences
        function generateConfidences(mainCategory, noiseLevel) {
            const confidences = {
                traffic: 15 + Math.random() * 20,
                construction: 15 + Math.random() * 20,
                people: 15 + Math.random() * 20,
                nature: 15 + Math.random() * 20,
                silence: 15 + Math.random() * 20
            };
            
            confidences[mainCategory] = 60 + Math.random() * 30;
            
            if (noiseLevel > 80) {
                confidences.construction += 10;
                confidences.silence = Math.max(5, confidences.silence - 15);
            } else if (noiseLevel > 65) {
                confidences.traffic += 10;
            } else if (noiseLevel < 40) {
                confidences.nature += 10;
                confidences.silence += 15;
            }
            
            return confidences;
        }

        // Analyze
        async function analyzeAudio(blob) {
            state.analyzing = true;
            render();
            
            await new Promise(r => setTimeout(r, 2000));

            const noiseLevel = calculateNoiseLevel();
            const category = classifyByNoiseLevel(noiseLevel);
            const confidences = generateConfidences(category, noiseLevel);
            const now = new Date();
            const envData = await getEnvironmentalData();

            const recording = {
                id: Date.now(),
                timestamp: Date.now(),
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                hour: now.getHours(),
                dayOfWeek: now.toLocaleDateString('en-US', { weekday: 'long' }),
                location: state.currentLocation,
                locationName: state.locationName || 'Unnamed Location',
                category,
                confidences,
                noiseLevel: Math.round(noiseLevel),
                temperature: envData.temperature,
                humidity: envData.humidity,
                pressure: envData.pressure,
                windSpeed: Math.random() * 20
            };

            localStorage.setItem(`recording:${recording.id}`, JSON.stringify(recording));
            state.recordings.unshift(recording);
            state.analyzing = false;
            state.locationName = '';
            state.activeTab = 'map';
            state.success = '‚úÖ Analysis complete! Data saved to research database.';
            render();
        }

        // Delete
        function deleteRecording(id) {
            if (confirm('Delete this recording from the research database?')) {
                localStorage.removeItem(`recording:${id}`);
                state.recordings = state.recordings.filter(r => r.id !== id);
                render();
            }
        }

        // Clear all
        function clearAllData() {
            if (confirm('‚ö†Ô∏è WARNING: This will permanently delete all research data. Continue?')) {
                if (confirm('Are you absolutely sure? This cannot be undone!')) {
                    state.recordings.forEach(r => localStorage.removeItem(`recording:${r.id}`));
                    state.recordings = [];
                    state.success = 'All data has been cleared.';
                    render();
                }
            }
        }

        // Get color
        function getNoiseColor(level) {
            if (level < 40) return '#10b981';
            if (level < 55) return '#84cc16';
            if (level < 70) return '#f59e0b';
            if (level < 85) return '#f97316';
            return '#ef4444';
        }

        // Get icon
        function getCategoryIcon(category) {
            const icons = {
                traffic: 'üöó',
                construction: 'üèóÔ∏è',
                people: 'üë•',
                nature: 'üå≥',
                silence: 'üîá'
            };
            return icons[category] || 'üîä';
        }

        // Health impact
        function getHealthImpact(level) {
            if (level < 40) return { text: 'Excellent', color: '#10b981', risk: 'No Risk' };
            if (level < 55) return { text: 'Good', color: '#84cc16', risk: 'Low Risk' };
            if (level < 70) return { text: 'Moderate', color: '#f59e0b', risk: 'Moderate Risk' };
            if (level < 85) return { text: 'Poor', color: '#f97316', risk: 'High Risk' };
            return { text: 'Hazardous', color: '#ef4444', risk: 'Very High Risk' };
        }

        // Calculate advanced stats
        function calculateAdvancedStats() {
            if (state.recordings.length === 0) return null;
            
            const levels = state.recordings.map(r => r.noiseLevel);
            const avgNoise = levels.reduce((sum, l) => sum + l, 0) / levels.length;
            
            const sorted = [...levels].sort((a, b) => a - b);
            const median = sorted.length % 2 === 0
                ? (sorted[sorted.length / 2 - 1] + sorted[sorted.length / 2]) / 2
                : sorted[Math.floor(sorted.length / 2)];
            
            const variance = levels.reduce((sum, l) => sum + Math.pow(l - avgNoise, 2), 0) / levels.length;
            const stdDev = Math.sqrt(variance);
            
            const categoryCounts = state.recordings.reduce((acc, r) => {
                acc[r.category] = (acc[r.category] || 0) + 1;
                return acc;
            }, {});
            
            const hourCounts = state.recordings.reduce((acc, r) => {
                acc[r.hour] = (acc[r.hour] || 0) + 1;
                return acc;
            }, {});
            
            const dayCounts = state.recordings.reduce((acc, r) => {
                acc[r.dayOfWeek] = (acc[r.dayOfWeek] || 0) + 1;
                return acc;
            }, {});
            
            const mostCommon = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1])[0];
            const quietestSpot = state.recordings.reduce((min, r) => r.noiseLevel < min.noiseLevel ? r : min);
            const loudestSpot = state.recordings.reduce((max, r) => r.noiseLevel > max.noiseLevel ? r : max);
            
            const npi = Math.min(100, Math.max(0, ((avgNoise - 30) / 70) * 100));
            
            const avgTemp = state.recordings.reduce((sum, r) => sum + r.temperature, 0) / state.recordings.length;
            const avgHumidity = state.recordings.reduce((sum, r) => sum + r.humidity, 0) / state.recordings.length;
            
            return {
                avgNoise: avgNoise.toFixed(1),
                median: median.toFixed(1),
                stdDev: stdDev.toFixed(1),
                min: Math.min(...levels),
                max: Math.max(...levels),
                totalRecordings: state.recordings.length,
                mostCommon: mostCommon ? mostCommon[0] : 'none',
                categoryCounts,
                hourCounts,
                dayCounts,
                quietestSpot,
                loudestSpot,
                npi: npi.toFixed(1),
                healthImpact: getHealthImpact(avgNoise),
                avgTemp: avgTemp.toFixed(1),
                avgHumidity: avgHumidity.toFixed(1)
            };
        }

        // Export CSV
        function exportAdvancedData() {
            if (state.recordings.length === 0) {
                alert('No data to export');
                return;
            }
            
            const headers = [
                'ID', 'Timestamp', 'Date', 'Time', 'Day', 'Hour', 'Location Name', 
                'Latitude', 'Longitude', 'Category', 'Noise Level (dB)', 
                'Health Impact', 'Health Risk', 'Temperature (¬∞C)', 'Temperature (¬∞F)', 
                'Humidity (%)', 'Wind Speed (km/h)', 'Traffic %', 'Construction %', 
                'People %', 'Nature %', 'Silence %'
            ];
            
            const rows = state.recordings.map(r => {
                const health = getHealthImpact(r.noiseLevel);
                const tempF = (r.temperature * 9/5 + 32).toFixed(1);
                return [
                    r.id,
                    r.timestamp,
                    r.date,
                    r.time,
                    r.dayOfWeek,
                    r.hour,
                    r.locationName,
                    r.location.lat,
                    r.location.lng,
                    r.category,
                    r.noiseLevel,
                    health.text,
                    health.risk,
                    r.temperature.toFixed(1),
                    tempF,
                    r.humidity.toFixed(1),
                    r.windSpeed.toFixed(1),
                    r.confidences.traffic.toFixed(1),
                    r.confidences.construction.toFixed(1),
                    r.confidences.people.toFixed(1),
                    r.confidences.nature.toFixed(1),
                    r.confidences.silence.toFixed(1)
                ];
            });
            
            const csv = [headers, ...rows].map(row => row.join(',')).join('\\n');
            downloadFile(csv, `articul8-ecosense-data-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
        }

        // Generate report
        function generateReport() {
            const stats = calculateAdvancedStats();
            if (!stats) {
                alert('No data available for report generation');
                return;
            }
            
            const report = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë          ARTICUL8 ECOSENSE - ENVIRONMENTAL REPORT             ‚ïë
‚ïë          Multi-Sensor Monitoring Platform                     ‚ïë
‚ïë          Sound ‚Ä¢ Temperature ‚Ä¢ Humidity Analysis              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Generated: ${new Date().toLocaleString()}
Research ID: ${Date.now()}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìä EXECUTIVE SUMMARY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Total Measurements: ${stats.totalRecordings}
Study Duration: ${state.recordings.length > 0 ? Math.ceil((Date.now() - state.recordings[state.recordings.length-1].timestamp) / (1000*60*60*24)) : 0} days
Data Points Collected: ${stats.totalRecordings}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìà STATISTICAL ANALYSIS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Mean Noise Level: ${stats.avgNoise} dB
Median Noise Level: ${stats.median} dB
Standard Deviation: ${stats.stdDev} dB
Range: ${stats.min} - ${stats.max} dB
Noise Pollution Index: ${stats.npi}/100

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üè• HEALTH IMPACT ASSESSMENT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Overall Classification: ${stats.healthImpact.text}
Risk Level: ${stats.healthImpact.risk}
WHO Comparison: ${parseFloat(stats.avgNoise) > 55 ? 'EXCEEDS' : 'WITHIN'} recommended limits (55 dB)
EPA Comparison: ${parseFloat(stats.avgNoise) > 70 ? 'EXCEEDS' : 'WITHIN'} safe limits (70 dB)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìç LOCATION ANALYSIS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üü¢ QUIETEST LOCATION
   Name: ${stats.quietestSpot.locationName}
   Level: ${stats.quietestSpot.noiseLevel} dB
   Category: ${stats.quietestSpot.category}
   Time: ${stats.quietestSpot.time}
   Date: ${stats.quietestSpot.date}
   Coordinates: ${stats.quietestSpot.location.lat}, ${stats.quietestSpot.location.lng}

üî¥ LOUDEST LOCATION
   Name: ${stats.loudestSpot.locationName}
   Level: ${stats.loudestSpot.noiseLevel} dB
   Category: ${stats.loudestSpot.category}
   Time: ${stats.loudestSpot.time}
   Date: ${stats.loudestSpot.date}
   Coordinates: ${stats.loudestSpot.location.lat}, ${stats.loudestSpot.location.lng}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üéØ SOUND CATEGORY DISTRIBUTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${Object.entries(stats.categoryCounts).map(([cat, count]) => 
    `${getCategoryIcon(cat)} ${cat.toUpperCase()}: ${count} (${((count/stats.totalRecordings)*100).toFixed(1)}%)`
).join('\\n')}

Most Dominant: ${stats.mostCommon} (${((stats.categoryCounts[stats.mostCommon]/stats.totalRecordings)*100).toFixed(1)}%)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üå°Ô∏è ENVIRONMENTAL CONDITIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Average Temperature: ${stats.avgTemp}¬∞C (${(parseFloat(stats.avgTemp) * 9/5 + 32).toFixed(1)}¬∞F)
Average Humidity: ${stats.avgHumidity}%
Environmental Correlation: ${parseFloat(stats.avgTemp) > 25 && parseFloat(stats.avgNoise) > 60 ? 
    'High temperature correlates with increased noise activity' : 
    'Environmental conditions within normal parameters'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üí° KEY FINDINGS & RECOMMENDATIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${parseFloat(stats.avgNoise) > 70 ? 
`‚ö†Ô∏è CRITICAL: High noise pollution detected
   - Average levels (${stats.avgNoise} dB) exceed safe exposure limits
   - Recommend immediate intervention strategies
   - Priority: Noise barriers, traffic management, vegetation buffers
` : ''}
${stats.categoryCounts.traffic > stats.totalRecordings * 0.5 ? 
`üöó TRAFFIC DOMINANCE IDENTIFIED
   - Traffic noise constitutes ${((stats.categoryCounts.traffic/stats.totalRecordings)*100).toFixed(1)}% of samples
   - Recommend traffic calming measures
   - Consider vehicle restrictions during peak hours
   - Implement speed limit enforcement
` : ''}
${stats.categoryCounts.nature > 0 ? 
`üå≥ POSITIVE: Natural acoustic environments detected
   - Nature sounds provide ${((stats.categoryCounts.nature/stats.totalRecordings)*100).toFixed(1)}% acoustic relief
   - Recommend expanding green spaces
   - Plant additional trees as natural sound barriers
` : ''}
${parseFloat(stats.avgNoise) < 55 ?
`‚úÖ EXCELLENT: Noise levels within WHO guidelines
   - Current environment supports health and wellbeing
   - Maintain current conditions
   - Continue monitoring for quality assurance
` : ''}

Data Quality: ${stats.totalRecordings >= 20 ? 'EXCELLENT' : stats.totalRecordings >= 10 ? 'GOOD' : 'NEEDS MORE SAMPLES'}
Recommendation: ${stats.totalRecordings < 30 ? 'Collect additional samples for robust statistical analysis' : 'Dataset is comprehensive'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìö METHODOLOGY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Platform: Articul8 EcoSense Multi-Sensor Environmental Monitoring Platform
Sensors: Sound Level Analyzer, Temperature Sensor, Humidity Sensor
Audio Analysis: Real-time frequency spectrum analysis
Classification: AI-powered multi-category detection
Standards: WHO, EPA, ISO 1996-1:2016
Sampling Rate: 48 kHz
Recording Duration: 5 seconds per sample
Analysis Algorithm: Machine learning acoustic classification

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìñ REFERENCES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. World Health Organization. (2018). Environmental Noise Guidelines
   for the European Region. WHO Regional Office for Europe.
   
2. U.S. Environmental Protection Agency. (1974). Information on Levels
   of Environmental Noise Requisite to Protect Public Health and Welfare.
   
3. ISO 1996-1:2016. Acoustics ‚Äî Description, measurement and assessment
   of environmental noise ‚Äî Part 1: Basic quantities and assessment procedures.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

¬© Articul8 EcoSense - Multi-Sensor Environmental Monitoring Platform
Measuring Sound Levels, Temperature & Humidity
Report Generated by Advanced AI Analytics Engine
            `.trim();
            
            downloadFile(report, `articul8-ecosense-report-${new Date().toISOString().split('T')[0]}.txt`, 'text/plain');
            state.success = 'üìÑ Professional research report generated!';
            render();
        }

        // Download file helper
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Create charts
        function createCharts() {
            setTimeout(() => {
                const stats = calculateAdvancedStats();
                if (!stats) return;

                // Category chart
                const catCtx = document.getElementById('categoryChart');
                if (catCtx && charts.category) charts.category.destroy();
                if (catCtx) {
                    charts.category = new Chart(catCtx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(stats.categoryCounts).map(c => c.charAt(0).toUpperCase() + c.slice(1)),
                            datasets: [{
                                data: Object.values(stats.categoryCounts),
                                backgroundColor: ['#ef4444', '#f97316', '#3b82f6', '#10b981', '#6b7280'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { 
                                    position: 'bottom',
                                    labels: { color: '#fff', font: { size: 12 } }
                                }
                            }
                        }
                    });
                }

                // Time chart
                const timeCtx = document.getElementById('timeChart');
                if (timeCtx && charts.time) charts.time.destroy();
                if (timeCtx) {
                    const hours = Array.from({length: 24}, (_, i) => i);
                    const counts = hours.map(h => stats.hourCounts[h] || 0);
                    
                    charts.time = new Chart(timeCtx, {
                        type: 'bar',
                        data: {
                            labels: hours.map(h => `${h}:00`),
                            datasets: [{
                                label: 'Recordings',
                                data: counts,
                                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                                borderColor: '#667eea',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                x: {
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: '#fff' } }
                            }
                        }
                    });
                }

                // Trend chart
                const trendCtx = document.getElementById('trendChart');
                if (trendCtx && charts.trend) charts.trend.destroy();
                if (trendCtx) {
                    const sortedRecordings = [...state.recordings].reverse();
                    charts.trend = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: sortedRecordings.map((r, i) => `#${i+1}`),
                            datasets: [{
                                label: 'Noise Level (dB)',
                                data: sortedRecordings.map(r => r.noiseLevel),
                                borderColor: '#f093fb',
                                backgroundColor: 'rgba(240, 147, 251, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 4,
                                pointBackgroundColor: '#f093fb'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { 
                                    beginAtZero: true, 
                                    max: 100,
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                },
                                x: {
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255,255,255,0.1)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: '#fff' } }
                            }
                        }
                    });
                }
            }, 100);
        }

        // Initialize map
        function initializeMap() {
            setTimeout(() => {
                if (state.mapInstance) return;
                
                const mapElement = document.getElementById('map');
                if (!mapElement) return;

                const centerLat = state.currentLocation ? state.currentLocation.lat : 31.9539;
                const centerLng = state.currentLocation ? state.currentLocation.lng : 35.9106;

                state.mapInstance = L.map('map').setView([centerLat, centerLng], 13);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(state.mapInstance);

                // Add markers
                state.recordings.forEach(r => {
                    const color = getNoiseColor(r.noiseLevel);
                    const icon = L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background: ${color}; width: 30px; height: 30px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-size: 16px;">${getCategoryIcon(r.category)}</div>`,
                        iconSize: [30, 30]
                    });

                    L.marker([r.location.lat, r.location.lng], { icon })
                        .bindPopup(`
                            <div style="font-family: Inter; min-width: 200px;">
                                <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 700;">${r.locationName}</h3>
                                <p style="margin: 4px 0;"><strong>Level:</strong> ${r.noiseLevel} dB</p>
                                <p style="margin: 4px 0;"><strong>Category:</strong> ${r.category}</p>
                                <p style="margin: 4px 0;"><strong>Time:</strong> ${r.time}</p>
                                <p style="margin: 4px 0;"><strong>Date:</strong> ${r.date}</p>
                            </div>
                        `)
                        .addTo(state.mapInstance);
                });

                // Heat map layer
                if (state.recordings.length > 0) {
                    const heatData = state.recordings.map(r => [
                        r.location.lat,
                        r.location.lng,
                        r.noiseLevel / 100
                    ]);
                    L.heatLayer(heatData, { radius: 25, blur: 15, maxZoom: 17 }).addTo(state.mapInstance);
                }
            }, 100);
        }

        // Render
        function render() {
            const stats = calculateAdvancedStats();
            
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen p-4 md:p-8">
                    ${renderHeader(stats)}
                    ${renderNav()}
                    <div class="max-w-7xl mx-auto mt-8">
                        ${state.activeTab === 'home' ? renderHome(stats) : ''}
                        ${state.activeTab === 'record' ? renderRecord() : ''}
                        ${state.activeTab === 'map' ? renderMap() : ''}
                        ${state.activeTab === 'analytics' ? renderAnalytics(stats) : ''}
                        ${state.activeTab === 'data' ? renderData() : ''}
                    </div>
                </div>
            `;

            if (state.activeTab === 'analytics' && stats) {
                createCharts();
            }
            
            if (state.activeTab === 'map') {
                initializeMap();
            }
        }

        function renderHeader(stats) {
            return `
                <div class="glass-strong rounded-3xl shadow-2xl overflow-hidden">
                    <div class="max-w-7xl mx-auto px-6 md:px-10 py-8">
                        <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                            <div class="text-center md:text-left">
                                <div class="flex items-center gap-3 justify-center md:justify-start mb-2">
                                    <div class="text-5xl float">üåø</div>
                                    <h1 class="text-4xl md:text-5xl font-bold neon-text">Articul8 EcoSense</h1>
                                </div>
                                <p class="text-gray-300 text-lg">Environmental Monitoring Platform</p>
                                <p class="text-gray-400 text-sm mt-1">Sound Level ‚Ä¢ Temperature ‚Ä¢ Humidity Analysis</p>
                                <div class="flex gap-2 mt-3 justify-center md:justify-start flex-wrap">
                                    <span class="badge" style="background: rgba(16, 185, 129, 0.2); color: #10b981;">üî¨ Multi-Sensor</span>
                                    <span class="badge" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">ü§ñ AI-Powered</span>
                                    <span class="badge" style="background: rgba(251, 146, 60, 0.2); color: #fb923c;">üå°Ô∏è Climate Data</span>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-5xl font-bold neon-text">${state.recordings.length}</div>
                                <div class="text-gray-300 mt-2">Data Points</div>
                                ${stats ? `<div class="text-sm text-gray-400 mt-1">NPI: ${stats.npi}/100</div>` : ''}
                            </div>
                        </div>
                        
                        ${state.error ? `
                            <div class="mt-6 p-4 rounded-2xl bg-red-500/20 border border-red-500/50">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">‚ö†Ô∏è</span>
                                    <span class="text-red-200 font-medium">${state.error}</span>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${state.success ? `
                            <div class="mt-6 p-4 rounded-2xl bg-green-500/20 border border-green-500/50">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">‚ú®</span>
                                    <span class="text-green-200 font-medium">${state.success}</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderNav() {
            const tabs = [
                { id: 'home', icon: 'üè†', label: 'Dashboard' },
                { id: 'record', icon: 'üé§', label: 'Record' },
                { id: 'map', icon: 'üó∫Ô∏è', label: 'Map' },
                { id: 'analytics', icon: 'üìä', label: 'Analytics' },
                { id: 'data', icon: 'üíæ', label: 'Database' }
            ];

            return `
                <div class="max-w-7xl mx-auto mt-8">
                    <div class="glass-strong rounded-2xl p-2 shadow-xl flex flex-wrap gap-2 relative">
                        ${tabs.map((tab, i) => `
                            <button 
                                onclick="state.activeTab='${tab.id}'; render()"
                                class="flex-1 min-w-[100px] py-4 px-4 rounded-xl font-semibold transition-all ${
                                    state.activeTab === tab.id
                                        ? 'neon-border shimmer text-white'
                                        : 'text-gray-300 hover:bg-white/5'
                                }">
                                <div class="text-2xl mb-1">${tab.icon}</div>
                                <div class="text-sm">${tab.label}</div>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderHome(statsParam) {
            const stats = statsParam;
            if (!stats) {
                return `
                    <div class="glass-strong rounded-3xl p-16 text-center shadow-2xl">
                        <div class="text-8xl mb-6 float">üåø</div>
                        <h2 class="text-4xl font-bold neon-text mb-4">Welcome to Articul8 EcoSense</h2>
                        <p class="text-gray-300 text-xl mb-4 max-w-2xl mx-auto">
                            Advanced multi-sensor environmental monitoring platform powered by artificial intelligence.
                        </p>
                        <p class="text-gray-400 text-lg mb-8 max-w-2xl mx-auto">
                            Measure and analyze sound levels, temperature, and humidity for comprehensive environmental research.
                        </p>
                        <button onclick="state.activeTab='record'; render()" 
                            class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-10 py-5 rounded-2xl font-bold text-xl shadow-2xl hover:shadow-3xl transition-all transform hover:scale-105 neon-border">
                            üöÄ Begin Monitoring
                        </button>
                    </div>
                `;
            }

            return `
                <div class="space-y-6">
                    <!-- Hero Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="glass-strong rounded-2xl p-6 shadow-xl stat-card neon-border">
                            <div class="text-sm text-gray-400 mb-2">Average Noise</div>
                            <div class="text-4xl font-bold" style="color: ${getNoiseColor(parseFloat(stats.avgNoise))}">${stats.avgNoise}</div>
                            <div class="text-sm text-gray-400 mt-1">decibels (dB)</div>
                        </div>
                        
                        <div class="glass-strong rounded-2xl p-6 shadow-xl stat-card neon-border">
                            <div class="text-sm text-gray-400 mb-2">Pollution Index</div>
                            <div class="text-4xl font-bold neon-text">${stats.npi}</div>
                            <div class="text-sm text-gray-400 mt-1">out of 100</div>
                        </div>
                        
                        <div class="glass-strong rounded-2xl p-6 shadow-xl stat-card neon-border">
                            <div class="text-sm text-gray-400 mb-2">Health Impact</div>
                            <div class="text-2xl font-bold mt-2" style="color: ${stats.healthImpact.color}">${stats.healthImpact.text}</div>
                            <div class="text-sm text-gray-400 mt-1">${stats.healthImpact.risk}</div>
                        </div>
                        
                        <div class="glass-strong rounded-2xl p-6 shadow-xl stat-card neon-border">
                            <div class="text-sm text-gray-400 mb-2">Dominant Sound</div>
                            <div class="text-4xl mb-1">${getCategoryIcon(stats.mostCommon)}</div>
                            <div class="text-sm text-white font-medium capitalize">${stats.mostCommon}</div>
                        </div>
                    </div>

                    <!-- Location Comparison -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                            <div class="flex items-center gap-2 mb-4">
                                <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                                <h3 class="text-xl font-bold text-green-400">Optimal Location</h3>
                            </div>
                            <div class="bg-green-500/10 rounded-xl p-5 border border-green-500/30">
                                <p class="font-bold text-white text-xl mb-3">${stats.quietestSpot.locationName}</p>
                                <div class="flex items-baseline gap-3 mb-3">
                                    <span class="text-4xl font-bold text-green-400">${stats.quietestSpot.noiseLevel}</span>
                                    <span class="text-gray-400">dB</span>
                                </div>
                                <div class="text-sm text-gray-300 space-y-1">
                                    <p>üéØ ${stats.quietestSpot.category}</p>
                                    <p>üìÖ ${stats.quietestSpot.date}</p>
                                    <p>‚è∞ ${stats.quietestSpot.time}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                            <div class="flex items-center gap-2 mb-4">
                                <div class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
                                <h3 class="text-xl font-bold text-red-400">Critical Zone</h3>
                            </div>
                            <div class="bg-red-500/10 rounded-xl p-5 border border-red-500/30">
                                <p class="font-bold text-white text-xl mb-3">${stats.loudestSpot.locationName}</p>
                                <div class="flex items-baseline gap-3 mb-3">
                                    <span class="text-4xl font-bold text-red-400">${stats.loudestSpot.noiseLevel}</span>
                                    <span class="text-gray-400">dB</span>
                                </div>
                                <div class="text-sm text-gray-300 space-y-1">
                                    <p>üéØ ${stats.loudestSpot.category}</p>
                                    <p>üìÖ ${stats.loudestSpot.date}</p>
                                    <p>‚è∞ ${stats.loudestSpot.time}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistical Overview -->
                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <h3 class="text-2xl font-bold neon-text mb-6">üìê Statistical Analysis</h3>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-6">
                            ${[
                                { label: 'Mean', value: stats.avgNoise, color: '#667eea' },
                                { label: 'Median', value: stats.median, color: '#764ba2' },
                                { label: 'Std Dev', value: stats.stdDev, color: '#f093fb' },
                                { label: 'Min', value: stats.min, color: '#10b981' },
                                { label: 'Max', value: stats.max, color: '#ef4444' }
                            ].map(stat => `
                                <div class="text-center">
                                    <div class="text-gray-400 text-sm mb-2">${stat.label}</div>
                                    <div class="text-3xl font-bold" style="color: ${stat.color}">${stat.value}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <h3 class="text-2xl font-bold neon-text mb-6">‚ö° Research Tools</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="state.activeTab='record'; render()" 
                                class="bg-gradient-to-br from-blue-600 to-blue-700 p-6 rounded-xl font-semibold shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 text-white">
                                <div class="text-3xl mb-2">üé§</div>
                                <div>New Sample</div>
                            </button>
                            <button onclick="exportAdvancedData()" 
                                class="bg-gradient-to-br from-green-600 to-green-700 p-6 rounded-xl font-semibold shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 text-white">
                                <div class="text-3xl mb-2">üì•</div>
                                <div>Export CSV</div>
                            </button>
                            <button onclick="generateReport()" 
                                class="bg-gradient-to-br from-purple-600 to-purple-700 p-6 rounded-xl font-semibold shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 text-white">
                                <div class="text-3xl mb-2">üìÑ</div>
                                <div>Report</div>
                            </button>
                            <button onclick="state.activeTab='analytics'; render()" 
                                class="bg-gradient-to-br from-pink-600 to-pink-700 p-6 rounded-xl font-semibold shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 text-white">
                                <div class="text-3xl mb-2">üìä</div>
                                <div>Analytics</div>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRecord() {
            return `
                <div class="glass-strong rounded-3xl shadow-2xl p-8 md:p-12">
                    <div class="text-center mb-10">
                        <div class="inline-flex items-center gap-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 px-8 py-4 rounded-full mb-8 border border-purple-500/30">
                            <span class="text-3xl">üìç</span>
                            <span class="font-bold text-xl text-purple-300">
                                ${state.currentLocation ? `${state.currentLocation.lat.toFixed(4)}¬∞N, ${state.currentLocation.lng.toFixed(4)}¬∞E` : 'Acquiring GPS coordinates...'}
                            </span>
                        </div>
                        
                        <input
                            type="text"
                            placeholder="üè´ Monitoring Site Name (e.g., 'Main Plaza', 'Library Wing A')"
                            value="${state.locationName}"
                            oninput="state.locationName=this.value"
                            class="w-full max-w-3xl mx-auto block px-8 py-5 bg-white/5 border-2 border-purple-500/30 rounded-2xl focus:ring-4 focus:ring-purple-500/50 focus:border-purple-500 text-xl text-white placeholder-gray-400"
                            ${state.isRecording || state.analyzing ? 'disabled' : ''}
                        />
                        <p class="text-sm text-gray-400 mt-3">üí° Use descriptive location names for comprehensive environmental analysis</p>
                    </div>

                    <div class="flex flex-col items-center gap-8">
                        ${!state.isRecording && !state.analyzing ? `
                            <div class="relative">
                                <button
                                    onclick="startRecording()"
                                    type="button"
                                    class="relative w-52 h-52 bg-gradient-to-br from-purple-600 via-pink-600 to-blue-600 hover:from-purple-700 hover:via-pink-700 hover:to-blue-700 text-white rounded-full shadow-2xl hover:shadow-3xl transition-all transform hover:scale-110 flex items-center justify-center neon-border group"
                                    style="cursor: pointer; border: none; outline: none;">
                                    <svg class="w-24 h-24 pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"></path>
                                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                        <line x1="12" y1="19" x2="12" y2="22"></line>
                                    </svg>
                                    <div class="absolute inset-0 rounded-full bg-white opacity-0 group-hover:opacity-10 transition-opacity pointer-events-none"></div>
                                </button>
                                <div class="absolute inset-0 rounded-full animate-ping opacity-20 bg-gradient-to-br from-purple-600 to-pink-600 pointer-events-none"></div>
                            </div>
                        ` : ''}

                        ${state.isRecording ? `
                            <div class="text-center">
                                <div class="relative">
                                    <button
                                        onclick="stopRecording()"
                                        class="relative w-52 h-52 bg-gradient-to-br from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white rounded-full shadow-2xl animate-pulse flex items-center justify-center">
                                        <svg class="w-20 h-20" viewBox="0 0 24 24" fill="currentColor">
                                            <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                                        </svg>
                                    </button>
                                    <div class="absolute -inset-4 rounded-full border-4 border-red-500 animate-ping opacity-50"></div>
                                </div>
                                
                                <!-- Real-time Spectrum Analyzer -->
                                <div class="mt-8 bg-black/30 rounded-2xl p-6 border border-red-500/30">
                                    <div class="text-red-400 text-sm font-bold mb-4">üî¥ LIVE AUDIO ANALYSIS</div>
                                    <div class="flex items-end justify-center gap-1 h-20">
                                        ${Array(32).fill(0).map(() => '<div class="freq-bar"></div>').join('')}
                                    </div>
                                    <div class="mt-4 text-center">
                                        <div class="text-5xl font-bold text-red-400">${state.realtimeDB}</div>
                                        <div class="text-sm text-gray-400">dB (Real-time)</div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 flex items-center justify-center gap-3">
                                    <div class="sound-wave bg-red-500"></div>
                                    <div class="sound-wave bg-red-500"></div>
                                    <div class="sound-wave bg-red-500"></div>
                                    <div class="sound-wave bg-red-500"></div>
                                    <div class="sound-wave bg-red-500"></div>
                                    <div class="sound-wave bg-red-500"></div>
                                    <div class="sound-wave bg-red-500"></div>
                                </div>
                            </div>
                        ` : ''}

                        ${state.analyzing ? `
                            <div class="text-center">
                                <div class="w-52 h-52 bg-gradient-to-br from-yellow-500 to-orange-600 text-white rounded-full shadow-2xl flex items-center justify-center relative">
                                    <div class="spinner absolute inset-4 border-4 border-white/20 border-t-white"></div>
                                    <svg class="w-24 h-24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 18V5l12-2v13"></path>
                                        <circle cx="6" cy="18" r="3"></circle>
                                        <circle cx="18" cy="16" r="3"></circle>
                                    </svg>
                                </div>
                                <p class="mt-8 text-2xl font-bold text-white">üî¨ AI Processing Environmental Data</p>
                                <p class="mt-3 text-gray-300 text-lg">Analyzing sound, temperature & humidity patterns...</p>
                            </div>
                        ` : ''}

                        <div class="text-center max-w-2xl">
                            <p class="text-3xl font-bold text-white mb-3">
                                ${state.isRecording ? 'üî¥ Recording Active' : state.analyzing ? '‚öôÔ∏è Analysis Phase' : 'üéØ Ready for Data Capture'}
                            </p>
                            <p class="text-gray-300 text-lg">
                                ${state.isRecording ? 'Capturing 5-second environmental sample with multi-sensor array...' : 
                                  state.analyzing ? 'Processing sound, temperature, and humidity data with AI algorithms...' : 
                                  'Initiate comprehensive environmental monitoring (sound, temperature, humidity)'}
                            </p>
                        </div>
                    </div>

                    <!-- Sound Categories -->
                    <div class="mt-12 grid grid-cols-2 md:grid-cols-5 gap-4">
                        ${['traffic', 'construction', 'people', 'nature', 'silence'].map(cat => `
                            <div class="glass rounded-2xl p-5 text-center hover:bg-white/10 transition-all transform hover:scale-105 border border-white/10">
                                <div class="text-5xl mb-3">${getCategoryIcon(cat)}</div>
                                <div class="text-sm font-bold text-white capitalize mb-1">${cat}</div>
                                <div class="text-xs text-gray-400">
                                    ${cat === 'traffic' ? '70-100 dB' : 
                                      cat === 'construction' ? '85-100 dB' :
                                      cat === 'people' ? '50-70 dB' :
                                      cat === 'nature' ? '35-50 dB' : '< 35 dB'}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Best Practices -->
                    <div class="mt-10 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-2xl p-6 border border-blue-500/30">
                        <h4 class="font-bold text-blue-300 mb-4 flex items-center gap-3 text-xl">
                            <span class="text-3xl">üí°</span>
                            Environmental Monitoring Guidelines
                        </h4>
                        <div class="grid md:grid-cols-2 gap-3 text-sm text-gray-300">
                            <div class="flex items-start gap-2">
                                <span class="text-green-400">‚úì</span>
                                <span>Maintain device stability during measurements</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-400">‚úì</span>
                                <span>Avoid direct sunlight for accurate temperature</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-400">‚úì</span>
                                <span>Record multiple samples per location</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-400">‚úì</span>
                                <span>Allow sensors to stabilize before recording</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-400">‚úì</span>
                                <span>Monitor across different times and weather</span>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-400">‚úì</span>
                                <span>Document environmental conditions in notes</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMap() {
            return `
                <div class="space-y-6">
                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <h3 class="text-2xl font-bold neon-text mb-6">üó∫Ô∏è Environmental Data Distribution Map</h3>
                        <div id="map" class="rounded-2xl overflow-hidden shadow-2xl"></div>
                        <p class="text-sm text-gray-400 mt-4 text-center">
                            üìç Interactive geospatial map ‚Ä¢ üå°Ô∏è Multi-sensor data points ‚Ä¢ üé® Color-coded by noise intensity
                        </p>
                    </div>

                    ${state.recordings.length === 0 ? `
                        <div class="bg-white rounded-xl shadow-lg p-16 text-center shadow-xl">
                            <div class="text-6xl mb-4">üìç</div>
                            <h3 class="text-2xl font-bold text-white mb-3">No Environmental Data</h3>
                            <p class="text-gray-400">Begin monitoring to populate the environmental map</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderAnalytics(statsParam) {
            const stats = statsParam;
            if (!stats) {
                return `
                    <div class="glass-strong rounded-2xl p-16 text-center shadow-xl">
                        <div class="text-6xl mb-4">üìä</div>
                        <h3 class="text-2xl font-bold text-white mb-3">Insufficient Data</h3>
                        <p class="text-gray-400 mb-6">Minimum 3 samples required for analytics</p>
                        <button onclick="state.activeTab='record'; render()" 
                            class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-xl font-semibold">
                            Start Recording
                        </button>
                    </div>
                `;
            }

            return `
                <div class="space-y-6">
                    <!-- Charts -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                            <h3 class="text-lg font-bold mb-4 neon-text">üéØ Category Distribution</h3>
                            <canvas id="categoryChart"></canvas>
                        </div>
                        
                        <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                            <h3 class="text-lg font-bold mb-4 neon-text">‚è∞ Temporal Analysis</h3>
                            <canvas id="timeChart"></canvas>
                        </div>
                    </div>

                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <h3 class="text-lg font-bold mb-4 neon-text">üìà Noise Level Progression</h3>
                        <canvas id="trendChart"></canvas>
                    </div>

                    <!-- Category Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        ${Object.entries(stats.categoryCounts).map(([cat, count]) => `
                            <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <span class="text-4xl">${getCategoryIcon(cat)}</span>
                                        <span class="font-bold text-lg capitalize text-white">${cat}</span>
                                    </div>
                                    <span class="text-3xl font-bold neon-text">${count}</span>
                                </div>
                                <div class="h-3 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-purple-600 to-pink-600" 
                                        style="width: ${(count/stats.totalRecordings)*100}%"></div>
                                </div>
                                <div class="text-sm text-gray-400 mt-3">
                                    ${((count/stats.totalRecordings)*100).toFixed(1)}% of total dataset
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- WHO Comparison -->
                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <h3 class="text-2xl font-bold mb-6 neon-text">üè• International Health Standards</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-5 bg-green-500/10 rounded-xl border border-green-500/30">
                                <div>
                                    <div class="font-bold text-green-300 text-lg">WHO Recommended (Day)</div>
                                    <div class="text-sm text-gray-400 mt-1">Safe continuous exposure threshold</div>
                                </div>
                                <div class="text-3xl font-bold text-green-400">55 dB</div>
                            </div>
                            <div class="flex items-center justify-between p-5 bg-yellow-500/10 rounded-xl border border-yellow-500/30">
                                <div>
                                    <div class="font-bold text-yellow-300 text-lg">Your Research Average</div>
                                    <div class="text-sm text-gray-400 mt-1">Mean environmental noise level</div>
                                </div>
                                <div class="text-3xl font-bold" style="color: ${getNoiseColor(parseFloat(stats.avgNoise))}">${stats.avgNoise} dB</div>
                            </div>
                            <div class="flex items-center justify-between p-5 bg-red-500/10 rounded-xl border border-red-500/30">
                                <div>
                                    <div class="font-bold text-red-300 text-lg">EPA Damage Threshold</div>
                                    <div class="text-sm text-gray-400 mt-1">Hearing damage risk with prolonged exposure</div>
                                </div>
                                <div class="text-3xl font-bold text-red-400">85 dB</div>
                            </div>
                        </div>
                    </div>

                    <!-- Insights -->
                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <h3 class="text-2xl font-bold mb-6 neon-text">üí° Research Findings</h3>
                        <div class="space-y-4">
                            ${parseFloat(stats.avgNoise) > 70 ? `
                                <div class="flex items-start gap-4 p-5 bg-red-500/10 rounded-xl border border-red-500/30">
                                    <span class="text-3xl">‚ö†Ô∏è</span>
                                    <div>
                                        <div class="font-bold text-red-300 text-lg">Critical Pollution Detected</div>
                                        <div class="text-sm text-gray-300 mt-2">Average noise levels (${stats.avgNoise} dB) exceed WHO safe exposure guidelines. Immediate environmental intervention recommended: acoustic barriers, traffic management systems, vegetation buffer zones.</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${stats.categoryCounts.traffic > stats.totalRecordings * 0.5 ? `
                                <div class="flex items-start gap-4 p-5 bg-orange-500/10 rounded-xl border border-orange-500/30">
                                    <span class="text-3xl">üöó</span>
                                    <div>
                                        <div class="font-bold text-orange-300 text-lg">Traffic Noise Dominance</div>
                                        <div class="text-sm text-gray-300 mt-2">Vehicular traffic constitutes ${((stats.categoryCounts.traffic/stats.totalRecordings)*100).toFixed(1)}% of acoustic environment. Mitigation strategies: traffic calming infrastructure, vehicle speed restrictions, alternative routing protocols.</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${stats.categoryCounts.nature > 0 ? `
                                <div class="flex items-start gap-4 p-5 bg-green-500/10 rounded-xl border border-green-500/30">
                                    <span class="text-3xl">üå≥</span>
                                    <div>
                                        <div class="font-bold text-green-300 text-lg">Natural Acoustic Buffer Identified</div>
                                        <div class="text-sm text-gray-300 mt-2">Natural soundscapes provide ${((stats.categoryCounts.nature/stats.totalRecordings)*100).toFixed(1)}% acoustic relief. Strategic recommendation: expand green infrastructure, implement biophilic design principles, establish urban forest corridors.</div>
                                    </div>
                                </div>
                            ` : ''}
                            <div class="flex items-start gap-4 p-5 bg-blue-500/10 rounded-xl border border-blue-500/30">
                                <span class="text-3xl">üìä</span>
                                <div>
                                    <div class="font-bold text-blue-300 text-lg">Dataset Quality Assessment</div>
                                    <div class="text-sm text-gray-300 mt-2">
                                        Current sample size: ${stats.totalRecordings} recordings
                                        ‚Ä¢ Statistical confidence: ${stats.totalRecordings >= 30 ? 'HIGH' : stats.totalRecordings >= 15 ? 'MODERATE' : 'DEVELOPING'}
                                        ‚Ä¢ ${stats.totalRecordings < 30 ? 'Recommendation: Collect additional samples for robust statistical significance' : 'Dataset meets research-grade standards'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderData() {
            return `
                <div class="space-y-6">
                    <!-- Actions -->
                    <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <h3 class="text-2xl font-bold neon-text">üíæ Research Database</h3>
                            <div class="flex flex-wrap gap-3">
                                <button onclick="exportAdvancedData()" 
                                    class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                                    üì• Export CSV
                                </button>
                                <button onclick="generateReport()" 
                                    class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                                    üìÑ Generate Report
                                </button>
                                <button onclick="clearAllData()" 
                                    class="bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                                    üóëÔ∏è Purge Database
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Recordings List -->
                    ${state.recordings.length === 0 ? `
                        <div class="glass-strong rounded-2xl p-16 text-center shadow-xl">
                            <div class="text-6xl mb-4">üìã</div>
                            <h3 class="text-2xl font-bold text-white mb-3">Empty Database</h3>
                            <p class="text-gray-400">No research data available</p>
                        </div>
                    ` : `
                        <div class="glass-strong rounded-2xl p-6 shadow-xl neon-border">
                            <h3 class="text-lg font-bold mb-6 text-white">Complete Dataset (${state.recordings.length} entries)</h3>
                            <div class="space-y-4 max-h-96 overflow-y-auto">
                                ${state.recordings.map(r => {
                                    const health = getHealthImpact(r.noiseLevel);
                                    return `
                                        <div class="glass rounded-xl p-6 transition-all hover:bg-white/10 border border-white/10">
                                            <div class="flex justify-between items-start gap-4">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-4 mb-4">
                                                        <span class="text-4xl">${getCategoryIcon(r.category)}</span>
                                                        <div>
                                                            <span class="font-bold text-xl capitalize text-white">${r.category}</span>
                                                            <div class="flex items-center gap-3 mt-2">
                                                                <span class="px-4 py-2 rounded-lg text-white text-sm font-bold shadow-lg" 
                                                                    style="background-color: ${getNoiseColor(r.noiseLevel)}">
                                                                    ${r.noiseLevel} dB
                                                                </span>
                                                                <span class="px-4 py-2 rounded-lg text-xs font-bold" 
                                                                    style="background-color: ${health.color}30; color: ${health.color}; border: 1px solid ${health.color}">
                                                                    ${health.text}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <p class="font-bold text-white text-lg mb-3">üìç ${r.locationName}</p>
                                                    <div class="text-sm text-gray-400 space-y-1">
                                                        <p>üìÖ ${r.date} ‚Ä¢ ‚è∞ ${r.time} ‚Ä¢ üåç ${r.location.lat.toFixed(4)}, ${r.location.lng.toFixed(4)}</p>
                                                        <p>üå°Ô∏è ${r.temperature.toFixed(1)}¬∞C (${(r.temperature * 9/5 + 32).toFixed(1)}¬∞F) ‚Ä¢ üíß ${r.humidity.toFixed(1)}% ‚Ä¢ üí® ${r.windSpeed.toFixed(1)} km/h</p>
                                                    </div>
                                                    <div class="mt-4 grid grid-cols-5 gap-2">
                                                        ${Object.entries(r.confidences).map(([cat, conf]) => `
                                                            <div>
                                                                <div class="text-xs text-gray-400 mb-1 capitalize">${cat}</div>
                                                                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                                                    <div class="h-full bg-gradient-to-r from-purple-600 to-pink-600" 
                                                                        style="width: ${conf}%"></div>
                                                                </div>
                                                                <div class="text-xs text-gray-500 mt-1">${conf.toFixed(0)}%</div>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                                <button onclick="deleteRecording(${r.id})" 
                                                    class="text-red-400 hover:text-red-300 hover:bg-red-500/10 p-3 rounded-xl transition-all">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `}
                </div>
            `;
        }

        // Initialize
        loadRecordings();
        getCurrentLocation();
        render();
    </script>
</body>
</html>